<!DOCTYPE html>
<html>

<head>
    <title>Map2 - The Block</title>

    <link rel="stylesheet" type="text/css" href="style.css" />

    <script type="text/javascript" src="Clarity.js"></script>

    <link rel="icon" href="./icon/clarity.ico" type="image/x-icon">

    <link rel="shortcut icon" href="./icon/clarity.ico" type="image/x-icon">

</head>

<body>
    <p class="title"> The Block </p>
    <canvas id="canvas"></canvas>

    <p>
        使用左、右和上箭头键移动。
    </p>

    <p class="info">
        地图数据是完全可定制和可编写脚本的（全部包含在“map”变量中）。有关说明，请参见代码中的注释。需要源码，请返回menu。
    </p>

    <label for="viewport">
        <input type="checkbox" id="viewport" onclick="game.limit_viewport=this.checked;" checked/> 将视口限制到地图</label>
    <a href='index.html'>menu</a>
    <a href='update log.html'>Update Log</a>
    <a href='map1.html'>map1</a>
    <a href='map2.html'>map2</a>
    <script type="text/javascript">

        window.requestAnimFrame =
            window.requestAnimationFrame ||
            window.webkitRequestAnimationFrame ||
            window.mozRequestAnimationFrame ||
            window.oRequestAnimationFrame ||
            window.msRequestAnimationFrame ||
            function(callback) {
                return window.setTimeout(callback, 1000 / 60);
        };

        var canvas = document.getElementById('canvas'),
            ctx    = canvas.getContext('2d');

        canvas.width = 400;
        canvas.height = 400;
        
        /* 可定制地图数据*/

        var map = {
        
            tile_size: 16,
        
            /*
            
            主要价值：
            id[不可换的]-与数据数组中的平铺相对应的整数                    id
            颜色[不可换的]-任何javascript兼容的颜色变量                   colour
            固体[可选]-无论平铺是否实心，默认为false                      solid
            反弹[可选]—击中瓷砖时保持多少速度，0.5是一半                   bounce
            跳跃[可选]-玩家是否可以在棋盘上跳跃，默认为false               jump
            摩擦力[可选]—瓷砖的摩擦力，必须有X和Y值（例如{X:0.5，Y:0.5}）  friction
            重力[可选]—磁贴的重力，必须有X和Y值（例如{X:0.5，Y:0.5}）      gravity
            在前[可选]-是否在播放器前面绘制平铺，默认为false。              fore
            脚本[可选]—指脚本部分中的脚本，如果被触碰就执行。               script
            
            */
            
            keys: [
                {id: 0, colour: '#333', solid: 0},                            //虚空
                {id: 1, colour: '#888', solid: 0},                            //可以移动
                {id: 2,colour: '#555',solid: 1,bounce: 0.35},                 //墙壁
                {id: 3,colour: 'rgba(121, 220, 242, 0.4)',friction: {x: 0.9,y: 0.9},gravity: {x: 0,y: 0.1},jump: 1,fore: 1},  //水
                {id: 4,colour: '#777',jump: 1},                               //向上
                {id: 5,colour: '#E373FA',solid: 1,bounce: 1.1},               //跳高高
                {id: 6,colour: '#666',solid: 1,bounce: 0},                    //无弹力墙壁
                {id: 7,colour: '#73C6FA',solid: 0,script: 'change_colour'},   //换颜色
                {id: 8,colour: '#FADF73',solid: 0,script: 'next_level'},      //下一关
                {id: 9,colour: '#C93232',solid: 0,script: 'death'},           //死亡
                {id: 10,colour: '#555',solid: 1},                             //可解锁的方块，需配合11使用
                {id: 11,colour: '#0FF',solid: 0,script: 'unlock'},            //解锁
                {id: 12,colour: '#888',solid: 0},                             //可上锁的方块，需配合13使用
                {id: 13,colour: '#C0C0C0',solid: 0,script: 'lock'}            //上锁
            ],
        
            /* 表示地图分幅的数组。每个数字对应一个瓷砖 */  //可自定制
            data: [
            [2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2],
            [2,1,2,4,1,1,2,2,2,2,10,10,10,10,8,2,2,2,2,2,2,2,1,1,2],
            [2,1,6,4,1,1,6,2,2,2,10,1,1,1,1,2,2,2,2,10,10,10,10,7,2],
            [2,1,2,4,2,7,1,2,6,2,1,2,2,2,2,2,2,2,2,10,2,2,2,7,2],
            [2,1,2,4,2,3,1,1,2,2,4,1,1,1,10,10,10,2,2,10,2,0,2,7,2],
            [2,1,2,1,2,1,2,1,2,2,1,1,1,1,10,10,10,2,2,10,2,1,2,7,2],
            [2,1,1,1,2,1,2,1,6,1,1,1,1,1,1,2,4,2,2,10,2,2,2,7,2],
            [2,2,2,2,2,1,2,1,2,2,2,2,2,2,2,2,4,2,10,1,2,3,2,7,2],
            [2,4,1,1,2,9,2,1,2,2,2,2,2,2,2,2,4,2,10,2,2,4,2,7,2],
            [2,4,1,1,2,2,4,1,1,1,1,1,1,1,1,2,4,2,10,2,2,5,2,7,2],
            [2,4,2,13,2,2,4,1,1,3,1,1,1,1,1,2,4,2,10,2,2,6,2,7,2],
            [2,4,2,2,2,2,4,2,1,1,1,1,1,1,1,2,4,2,10,2,2,7,2,7,2],
            [2,1,1,1,1,1,1,2,9,9,12,12,9,9,1,2,4,2,10,2,2,8,2,7,2],
            [2,2,2,2,2,2,2,2,2,2,9,9,2,2,1,2,4,2,10,2,2,9,2,7,2],
            [2,4,1,1,2,1,1,2,2,2,2,2,2,2,7,2,4,2,10,2,2,10,2,7,2],
            [2,4,1,1,2,1,1,1,1,1,1,1,11,2,1,2,4,2,10,2,2,11,2,7,2],
            [2,4,2,4,2,1,2,2,2,2,2,2,2,2,7,2,4,2,10,2,2,12,2,7,2],
            [2,4,2,4,2,1,1,1,1,1,1,1,1,2,1,2,4,2,10,2,2,13,2,7,2],
            [2,4,2,1,2,1,1,1,1,1,1,1,1,2,7,2,4,2,10,2,2,2,2,7,2],
            [2,4,2,3,3,2,2,2,2,2,2,2,3,2,1,2,4,2,10,2,2,2,2,7,2],
            [2,4,2,3,3,3,3,3,3,3,3,3,3,2,7,2,4,2,10,2,2,2,2,7,2],
            [2,4,2,3,3,3,3,3,3,3,3,3,3,2,1,2,10,10,10,2,2,2,2,7,2],
            [2,4,2,2,2,2,2,2,2,2,2,2,2,2,7,2,2,2,2,2,2,2,2,7,2],
            [2,1,1,1,1,1,1,1,1,1,1,1,1,1,1,10,10,10,10,10,10,10,10,10,2],
            [2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,5,2]
            ],
        
            /* 地图的默认重力 */
            
            gravity: {
                x: 0,
                y: 0.3
            },
            
            /* 速度限制 */
        
            vel_limit: {
                x: 2,
                y: 16
            },
        
            /* 按键移动速度 */
            
            movement_speed: {
                jump: 6,
                left: 0.3,
                right: 0.3
            },
            
            /* 玩家出发的坐标和玩家的颜色 */
        
            player: {
                x: 1,
                y: 1,
                colour: '#FF9900'
            },
            
            /* 瓷砖键中的“脚本”变量引用的脚本 */
        
            scripts: {
                change_colour: 'this.player.colour = "#"+(Math.random()*0xFFFFFF<<0).toString(16);',
                /* 你可以在这里加载一个新的map变量 */
                next_level: 'alert("Yay! You won! Reloading map.");this.load_map(map);',
                death: 'alert("You died!");this.load_map(map);',
                unlock: 'this.current_map.keys[10].solid = 0;this.current_map.keys[10].colour = "#888";',
                lock: 'this.current_map.keys[12].solid = 1;this.current_map.keys[12].colour = "#555";'
            }
        };
        
        /* 启动的设置 */
        
        var game = new Clarity();
        game.set_viewport(canvas.width, canvas.height);
        game.load_map(map);

        /* 将视口限制在地图的范围内 */
        
        game.limit_viewport = true;

        var Loop = function() {

            ctx.fillStyle = '#333';
            ctx.fillRect(0, 0, canvas.width, canvas.height);

            game.update();
            game.draw(ctx);

            window.requestAnimFrame(Loop);
        };

        /* 开始 */
        
        Loop();
        
    </script>
</body>

</html>